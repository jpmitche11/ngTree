<!DOCTYPE HTML>
<html xmlns:ng="http://angularjs.org">
<head>
    <script src="http://code.angularjs.org/angular-1.0.0rc7.min.js"></script>
    <script src="AngularTree.js"></script>

    <script type="text/javascript">
        var testCtrl = function($scope, $log) {
            $scope.node = {
                name: "root",
                childNodes: [
                    {
                        name: "branch1",
                        childNodes: [
                            { name: "branch11", childNodes: [] },
                            { name: "branch12", childNodes: [] }
                        ]
                    },{
                        name: "branch3",
                        childNodes: [
                            { name: "last", childNodes: [] },
                            { name: "branch21", childNodes: [] },
                            { name: "branch22", childNodes: [] }
                        ]
                    },{
                        name: "branch2",
                        childNodes: []
                    }
                ]
            };
            makeDoubleLinkedTree($scope.node);
            /**
             * Make sure each node has a reference to the parent.
             * @param node
             */
            function makeDoubleLinkedTree(node) {
                var i, numOfChildren;
                if (typeof node.childNodes != 'undefined') {
                    numOfChildren = node.childNodes.length;
                    for (i = 0; i < numOfChildren; i++) {
                        node.childNodes[i].parent = node;
                        makeDoubleLinkedTree(node.childNodes[i]);
                    }
                }
            }

            $scope.modNodeName = function(nodeData) {
                nodeData.name += "+change";
            };
            $scope.addChild = function(nodeData) {
                var newNode = {
                    name: 'NewNode',
                    childNodes: [],
                    parent: nodeData
                };
                nodeData.childNodes.push(newNode);
            };
            $scope.removeChild = function(nodeData) {
                // Find the list of siblings that this node should be removed from
                var siblings = nodeData.parent.childNodes;
                var i = 0;
                for (i; i < siblings.length; i++) {
                    // Scan the siblings and remove the unwanted child
                    if (siblings[i] === nodeData) {
                        siblings.splice(i, 1);
                        break;
                    }
                }
            };
        }
    </script>
</head>

<body ng-app="TreeModule">
<div ng-controller="testCtrl">

    <ul>
        <li ng-tree="node" node-children="childNodes" node-order="name">
            <div>
                {{node.name}},
                <a ng:click='modNodeName(node)'>Change</a>
                <a ng:click='addChild(node)'>Add</a>
                <a ng:click='removeChild(node)'>Remove</a>
            </div>
            <ul>
                <ng-tree-child></ng-tree-child>
            </ul>
        </li>
    </ul>

</div>
</body>
</html>